# Основные компоненты браузера

1. **Пользовательский интерфейс** - кнопки, закладки, адресная строка.
2. **Исполнительная часть пользовательского интерфейса** - отрисовка основы - окон и панелей со списками. Не зависит от типа платформы, только от операционной системы.
3. **Модуль отображения** - вывод запрошенного на экран (анализ кода HTML и CSS). В Chrome - под каждую вкладку свой модуль.
4. **Механизм браузера** - управляет взаимодействием пользовательского интерфейса и модуля отображения.
5. **Сетевые компоненты** - выполнение сетевых запросов.
6. **Интерпритатор JavaScript**.
7. **Хранилище данных/Вэб-база данных**.

## Модуль отображения.

Для *Firefox* - Gecko, для *Safari*, *Chrome* - WebKit.

**Схема работы**:
Парсинг HTML (перевод тегов в узлы DOM-дерева содержания) -> Создание дерева отображения (извлечение информации о стилях их CSS и тегов style) -> Компоновка элементов (присвоение каждому узлу его координат) -> Отрисовка (с помощью исполнительской части пользовательского интерфейса).

**Отличия**: в терминологии: (Gecko/WebKit) дерево визуально оформленных элементов - дерево фреймов/дерево отображения(объектов); размещение элементов - обтекание(reflow)/компоновка(layout). + в Gecko существует доп. уровень между файлом HTML и деревом DOM - буфер содержания (content sink), который форматирует элементы DOM. В WebKit - совмещение (attachment).

При этом модуль отображения старается как можно раньше начать отрисовку, поэтому создание дерева отображения и компоновка могут начаться ещё до окончания анализа HTML. 

### Лексический анализ.

Разделение информации на лексемы (токены).Образуют словарь языка, конструктивные элементы для создания документов. 

Анализ выполняется двумя анализаторами - лексическим (разбирает входящие символы на токены) и синтаксическим (анализирует структуру документа согласно синтаксическим правилам, игнорирует переносы и отступы) => результат - синтаксическое дерево.

### Синтаксический анализ.

Преобразует код в пригодную для чтения и выполнения структуру. Результат - дерево узлов, которые передают структуру документа (*синтаксическое дерево* или *дерево синтаксического анализа*).

Синтаксический анализ работает на основе определённых правил, которые определяются форматом документа. Для каждого формата - свой словарь и синтаксис.

Запрашивает у лексического анализатора новый токен и проверяет на соответствие какому-либо синтаксическому правилу. Если удаётся - создаётся узел в синтаксическом дереве, если нет - откладывается и запрашивается новый. Так до момента, пока не найдутся все правила. Если для какой-то лексемы не нашлось => создается исключение.

Синтаксическое дерево - не всегда конечный результат, иногда это только этап - zB компиляция - компилятор для преобразование исходного кода в машинный разбирает код и составляет синтаксическое дерево, а потом на основе него создает документ с машинным кодом.

Синтаксические анализаторы бывают 2х типов: **восходящие** (обрабатывают последовательность символов и постепенно находят в ней синтаксические правила) и **нисходящие** (разбирают структуру верхнего уровня и проверяют соответствие правилам).

Для создания синтаксических анализаторов существуют специальные приложения - **генераторы**. В Webkit используются *Flex* (в него загружается файл с токенами - в формате регулярных выражений) и *Bison* (в него загружаются правила в формате BNF) ((они же *Leх* и *Yacc*)).

Словарь и синтаксис HTML определяется в спецификациях W3C. Но! Ни один из перечисленных анализаторов не подходит, так как HTML не такой строгий - может не хватать закрывающих тегов, но всё равно будет работать. Определение HTML задается в формате DTD (Document Type Definition)